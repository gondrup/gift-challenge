(window["tmg.build"]=window["tmg.build"]||[]).push([[22,9,14,16,20,25,26],[,,function(k,h,b){function l(e,b){for(var d=0;d<b.length;d++){var a=b[d];a.enumerable=a.enumerable||!1;a.configurable=!0;"value"in a&&(a.writable=!0);Object.defineProperty(e,a.key,a)}}b.r(h);var p=b(0);k=b(1);b=function(){function e(){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");!0;p.default.create("tmg.page");tmg.page={getMetaTag:this.getMetaTag,getMetaContent:this.getMetaContent,getPageType:this.getPageType,
getChannel:this.getChannel,getBusinessSegment:this.getBusinessSegment,getCategory:this.getCategory,getContentType:this.getContentType,getArticleId:this.getArticleId,getPublishDate:this.getPublishDate,getKeywords:this.getKeywords,getLocation:this.getLocation,getLeadAssetLayout:this.getLeadAssetLayout,isArticle:this.isArticle,isSponsored:this.isSponsored,isGallery:this.isGallery,isPremium:this.isPremium,isApp:this.isApp}}var b;return b=[{key:"getPageType",value:function(){return window.dataLayer&&window.dataLayer.pageType}},
{key:"getChannel",value:function(){return this.getMetaContent("tmgads.channel")}},{key:"getCategory",value:function(){return this.getMetaContent("DCSext.Category")}},{key:"getBusinessSegment",value:function(){return this.getMetaContent("tmgads.businessSegment")}},{key:"getContentType",value:function(){return this.getMetaContent("DCSext.Content_Type")}},{key:"getArticleId",value:function(){return this.getMetaContent("tmgads.articleid")}},{key:"getPublishDate",value:function(){return this.getMetaContent("DCSext.articleFirstPublished")}},
{key:"getKeywords",value:function(){return this.getMetaContent("keywords").split(",").map(function(d){return d.trim()})}},{key:"getLocation",value:function(){return document.location}},{key:"getMetaContent",value:function(d){var a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"content",c=this.getMetaTag(d),f="generic";return c&&c.getAttribute(a)&&(f=c.getAttribute(a)),f}},{key:"getMetaTag",value:function(d){return document.querySelector("meta[name\x3d'".concat(d,"']"))}},{key:"isArticle",
value:function(){var d=this,a=!1;return["articleRenderer","articleRenderer2"].forEach(function(c){d.getPageType()===c&&(a=!0)}),a}},{key:"isGallery",value:function(){return"galleryRenderer"===this.getPageType()}},{key:"isSponsored",value:function(){return"sponsored"===this.getBusinessSegment()}},{key:"isPremium",value:function(){return"true"===this.getMetaContent("tmg.premium.state")}},{key:"isApp",value:function(){return"true"===this.getMetaContent("tmg.app")}},{key:"isAuthor",value:function(){return document.documentElement.hasAttribute("data-is-author")}},
{key:"getLeadAssetLayout",value:function(){return this.isArticle()&&document.querySelector("[data-lead-asset-layout]")?document.querySelector("[data-lead-asset-layout]").dataset.leadAssetLayout:this.isArticle()?"hidden":void 0}}],l(e.prototype,b),e}();k.a.subscribe({topic:"tmg.page.ready",func:new b,runIfAlreadyPublished:!0});h.default=new b},function(k,h,b){function l(){for(var b=0,e={};b<arguments.length;b++){var g=arguments[b],d;for(d in g)e[d]=g[d]}return e}h.a=function g(e){function d(a,c,f){if(1<
arguments.length){if("number"==typeof(f=l({path:"/"},d.defaults,f)).expires){var b=new Date;b.setMilliseconds(b.getMilliseconds()+864E5*f.expires);f.expires=b}try{var g=JSON.stringify(c);/^[\{\[]/.test(g)&&(c=g)}catch(v){}return c=(c=encodeURIComponent(String(c))).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),a=(a=(a=encodeURIComponent(String(a))).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent)).replace(/[\(\)]/g,escape),document.cookie=[a,"\x3d",c,
f.expires&&"; expires\x3d"+f.expires.toUTCString(),f.path&&"; path\x3d"+f.path,f.domain&&"; domain\x3d"+f.domain,f.secure?"; secure":""].join("")}a||(g={});b=document.cookie?document.cookie.split("; "):[];for(var n=/(%[0-9A-Z]{2})+/g,t=0;t<b.length;t++){var m=b[t].split("\x3d"),r=m[0].replace(n,decodeURIComponent);m=m.slice(1).join("\x3d");'"'===m.charAt(0)&&(m=m.slice(1,-1));try{if(m=e&&e(m,r)||m.replace(n,decodeURIComponent),this.json)try{m=JSON.parse(m)}catch(v){}if(a===r){g=m;break}a||(g[r]=m)}catch(v){}}return g}
return d.get=d.set=d,d.getJSON=function(){return d.apply({json:!0},[].slice.call(arguments))},d.defaults={},d.remove=function(a,c){d(a,"",l(c,{expires:-1}))},d.withConverter=g,d}()},function(k,h,b){b.r(h);k=b(0);b={};var l=function(b){var d={};return"string"==typeof b&&(d=p(b.replace(/'/g,'"'))),d},p=function(b,d){d=d||{};var a=b,c=[],f=[],q=/[{?,\s]\s*"([^"]|\\")+"\s*:(\s*"([^"]|\\")+"|(.+))\s*[},]/gi,g=/^\s*{?\s*'|'\s*}?\s*$/i;if(!b)return d;if("[object Object]"===Object.prototype.toString.call(b))return b;
if(e(a)||((a.match(q)||[]).forEach(function(c){if(c.includes('"label"')){var b=c.replace(/^\s*[{\s]|[,}]\s*$/gi,"").split(":")[1].replace(/\s*"([^]+|\\")"\s*$/gi,"$1"),f=b.replace(/"/gi,'\\"');b=c.replace(b,f);a=a.replace(c,b)}}),c=a.replace(q,"").split(/,(?=(?:[^"]*"[^"]*")*[^"]*$)/)),c.forEach(function(a){a=a.replace(/^\s*{|}\s*$/gi,"");e("{".concat(a,"}"))||f.push(a)}),f.forEach(function(c){var b=!1,f=c;!0===g.test(c)&&(f=c.replace(/^\s*'([^']+|\\')':/,'"$1":').replace(/:\s*('')\s*$/,': ""').replace(/:\s*'([^']+|\\')'\s*$/,
': "$1"'),b=e("{".concat(f,"}")));b||!0!==/[^"']\w+[^"']:/.test(f)||(f=f.replace(/^\s*(.*?):/,'"$1":'),b=e("{".concat(f,"}")));b&&(a=a.replace(c,f))}),e(a))d=e(a);else try{JSON.parse(a)}catch(n){console.log("tmg.json.tryParse failed:",n)}return d},e=function(b){var d=!1;try{d=JSON.parse(b)}catch(a){}return d};b={parseFromAem:l,tryParse:p,simpleTryParse:e};k.default.create("tmg.json");tmg.json=b;h.default=b;tmg.parseAemJson=l},function(k,h,b){k=b(8);k=b.n(k);b(0).default.create("tmg.store");tmg.store=
k.a;h.a=k.a},function(k,h,b){b.r(h);var l=b(3),p=b(4);k=b(0);var e=b(5),g={pId:"",firstName:"",lastName:"",username:"",email:"",readerType:"",subscriber:"",subButton:""},d={livefyreToken:"livefyre-token",pianoRefToken:"user_ref_token",meterCount:"tmg_meter_count",personalisation:"tmg_p13n",publicId:"tmg_pid",registrationSuccess:"tmg_registration_success",rememberMe:"tmg_rem",session:"tmg_session",refreshToken:"tmg_refresh",subscriptionConfirmation:"tmg_subscription_confirmation"},a={},c=document.querySelector("html"),
f=function(){var a=document.querySelectorAll('[class*\x3d"'.concat("logged-in--",'"], [class*\x3d"').concat("is-subscriber--",'"]'));(a=Array.prototype.slice.call(a)).forEach(function(a){q(a,!0)})},q=function(a,c){if(c||f(),a)return c="\\b(?:".concat("logged-in--","|").concat("is-subscriber--",").+\\b"),a.className=a.className.replace(new RegExp(c,"g"),""),a.classList&&(a.classList.add("".concat("logged-in--").concat(n())),a.classList.add("".concat("is-subscriber--").concat(t()))),a.classList},u=
function(){var a=l.a.get(d.personalisation);return p.default.tryParse(a,g)},n=function(){return!!l.a.get(d.session)},t=function(){return"true"===a.subscriber},m=function(){return window.sessionStorage.removeItem("id_token"),window.sessionStorage.removeItem("access_token"),l.a.remove(d.session),r(),!0},r=function(){return a=u(),q(c),a};b={applyStatusCssClasses:q,clearAllData:function(){for(var a in m(),d)l.a.remove(d[a]);return e.a.remove("fyre-auth"),e.a.remove("fyre-authentication-creds"),r(),!0},
getLiveFyreToken:function(){return l.a.get(d.livefyreToken)||!1},getLiveFyreDetails:function(){var a=e.a.get("fyre-auth")||"{}";return p.default.tryParse(a)},getPianoRefToken:function(){return l.a.get(d.pianoRefToken)||!1},getMeterCount:function(){return!1},getMyTelegraphToken:function(){var a=e.a.storage.read("tmg.user.mytelegraph.token");return"undefined"!==a&&null!==a||(a=!1),a},getProfile:u,getSessionId:function(){return l.a.get(d.session)||""},getRefreshToken:function(){return l.a.get(d.refreshToken)||
""},isLoggedIn:n,isRegistered:function(){return!!a.pId},isSubscriber:t,canComment:function(){return"true"===a.subscriber&&!!l.a.get(d.session)},isMyTelegraphOnboarded:function(){return!!e.a.storage.read("tmg.user.mytelegraph.onboarded.status")},login:function(){return r(),!1},logout:m,setMyTelegraphToken:function(a){return e.a.storage.write("tmg.user.mytelegraph.token",a.token)},setMyTelegraphOnboarded:function(a){return e.a.storage.write("tmg.user.mytelegraph.onboarded.status",a.status)},updateState:r};
k.default.create("tmg.user");window.tmg.user=b;a=r();h.default=b},function(k,h,b){b.r(h);var l;k=b(0);var p=b(2),e=new RegExp(/\?[^#]*|(?=#)|$/),g=(l={},function(a){return l[a]||(l[a]=new RegExp("([?\x26;]".concat(a,"(?\x3d[\x3d\x26;#]|$))\x3d?([^\x26;#]*)")))}),d=function(a,c){return(a=g(c).exec(a))&&decodeURIComponent(a[2])},a=function(a,c,b){var f,q,m;return void 0===a&&(a=p.default.getLocation().search),null===d(a,c)?(f="".concat(c,"\x3d").concat(encodeURIComponent(b)),q=e.exec(a)[0],m=a.replace(e,
(q.length?q+"\x26":"?")+f)):m=a.replace(g(c),"$1\x3d".concat(encodeURIComponent(b))),m};b=function(a,c){if(null!==d(c,a)){var b=c.split("?")[0];c=(-1!==c.indexOf("?")?c.split("?")[1]:"").split("\x26");for(var f=c.length-1;0<=f;--f)c[f].split("\x3d")[0]===a&&c.splice(f,1);return b+(0<c.length?"?":"")+c.join("\x26")}return c};var c=function(c,b){return null!==d(c,"redirectTo")?a(c,"redirectTo",b):c};k.default.create("tmg.GET_PARAM");tmg.getQuerystringParam=d;tmg.setQuerystringParam=a;tmg.removeQuerystringParam=
b;tmg.updateRedirectParam=c;location.search.substr(1).split("\x26").forEach(function(a){a=a.split("\x3d");1<a.length?tmg.GET_PARAM[a[0]]=decodeURIComponent(a[1]):tmg.GET_PARAM[a[0]]=""});h.default={matchParam:g,matchQuerystring:e,getQuerystringParam:d,removeQuerystringParam:b,setQuerystringParam:a,updateRedirectParam:c}},function(k,h,b){(function(b){k.exports=function a(b,g,d){function c(e,n){if(!g[e]){if(!b[e]){if(f)return f(e,!0);n=Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",
n;}n=g[e]={exports:{}};b[e][0].call(n.exports,function(a){return c(b[e][1][a]||a)},n,n.exports,a,b,g,d)}return g[e].exports}for(var f=!1,e=0;e<d.length;e++)c(d[e]);return c}({1:[function(b,g,d){d=b("../src/store-engine");b=[b("../storages/localStorage"),b("../storages/sessionStorage"),b("../storages/cookieStorage"),b("../storages/memoryStorage")];g.exports=d.createStore(b,[])},{"../src/store-engine":2,"../storages/cookieStorage":4,"../storages/localStorage":5,"../storages/memoryStorage":6,"../storages/sessionStorage":7}],
2:[function(b,g,d){function a(a,b,d){d||(d="");a&&!h(a)&&(a=[a]);b&&!h(b)&&(b=[b]);var w=d?"__storejs_"+d+"_":"",x=d?new RegExp("^"+w):null;if(!/^[a-zA-Z0-9_\-]*$/.test(d))throw Error("store.js namespaces can only have alphanumerics + underscores and dashes");var g=n({_namespacePrefix:w,_namespaceRegexp:x,_testStorage:function(a){try{a.write("__storejs__test__","__storejs__test__");var b="__storejs__test__"===a.read("__storejs__test__");return a.remove("__storejs__test__"),b}catch(y){return!1}},_assignPluginFnProp:function(a,
b){var d=this[b];this[b]=function(){var b=c(arguments,0),f=this,w=[function(){if(d)return e(arguments,function(a,c){b[c]=a}),d.apply(f,b)}].concat(b);return a.apply(f,w)}},_serialize:function(a){return JSON.stringify(a)},_deserialize:function(a,b){if(!a)return b;var c="";try{c=JSON.parse(a)}catch(z){c=a}return void 0!==c?c:b},_addStorage:function(a){this.enabled||this._testStorage(a)&&(this.storage=a,this.enabled=!0)},_addPlugin:function(a){var b=this;if(h(a))e(a,function(a){b._addPlugin(a)});else if(!f(this.plugins,
function(b){return a===b})){if(this.plugins.push(a),!m(a))throw Error("Plugins must be function values that return objects");var c=a.call(this);if(!r(c))throw Error("Plugins must return an object of function properties");e(c,function(c,d){if(!m(c))throw Error("Bad plugin property: "+d+" from plugin "+a.name+". Plugins should only return functions.");b._assignPluginFnProp(c,d)})}},addStorage:function(a){(function(){var a="undefined"==typeof console?null:console;a&&(a.warn?a.warn:a.log).apply(a,arguments)})("store.addStorage(storage) is deprecated. Use createStore([storages])");
this._addStorage(a)}},v,{plugins:[]});return g.raw={},e(g,function(a,b){m(a)&&(g.raw[b]=k(g,a))}),e(a,function(a){g._addStorage(a)}),e(b,function(a){g._addPlugin(a)}),g}b=b("./util");var c=b.slice,f=b.pluck,e=b.each,k=b.bind,n=b.create,h=b.isList,m=b.isFunction,r=b.isObject;g.exports={createStore:a};var v={version:"2.0.12",enabled:!1,get:function(a,b){a=this.storage.read(this._namespacePrefix+a);return this._deserialize(a,b)},set:function(a,b){return void 0===b?this.remove(a):(this.storage.write(this._namespacePrefix+
a,this._serialize(b)),b)},remove:function(a){this.storage.remove(this._namespacePrefix+a)},each:function(a){var b=this;this.storage.each(function(c,d){a.call(b,b._deserialize(c),(d||"").replace(b._namespaceRegexp,""))})},clearAll:function(){this.storage.clearAll()},hasNamespace:function(a){return this._namespacePrefix=="__storejs_"+a+"_"},createStore:function(){return a.apply(this,arguments)},addPlugin:function(a){this._addPlugin(a)},namespace:function(b){return a(this.storage,this.plugins,b)}}},
{"./util":3}],3:[function(e,g,d){(function(a){function b(a,b){return Array.prototype.slice.call(a,b||0)}function d(a,b){e(a,function(a,c){return b(a,c),!1})}function e(a,b){if(h(a))for(var c=0;c<a.length;c++){if(b(a[c],c))return a[c]}else for(c in a)if(a.hasOwnProperty(c)&&b(a[c],c))return a[c]}function h(a){return null!=a&&"function"!=typeof a&&"number"==typeof a.length}var n=Object.assign?Object.assign:function(a,b,c,f){for(var e=1;e<arguments.length;e++)d(Object(arguments[e]),function(b,c){a[c]=
b});return a},k=function(){if(Object.create)return function(a,c,d,e){var f=b(arguments,1);return n.apply(this,[Object.create(a)].concat(f))};var a=function(){};return function(c,d,f,e){var g=b(arguments,1);return a.prototype=c,n.apply(this,[new a].concat(g))}}();g.exports={assign:n,create:k,trim:String.prototype.trim?function(a){return String.prototype.trim.call(a)}:function(a){return a.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")},bind:function(a,b){return function(){return b.apply(a,Array.prototype.slice.call(arguments,
0))}},slice:b,each:d,map:function(a,b){var c=h(a)?[]:{};return e(a,function(a,d){return c[d]=b(a,d),!1}),c},pluck:e,isList:h,isFunction:function(a){return a&&"[object Function]"==={}.toString.call(a)},isObject:function(a){return a&&"[object Object]"==={}.toString.call(a)},Global:"undefined"!=typeof window?window:a}}).call(this,void 0!==b?b:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],4:[function(b,g,d){function a(a){for(var b=h.cookie.split(/; ?/g),c=b.length-1;0<=c;c--)if(e(b[c])){var d=
b[c].split("\x3d"),f=unescape(d[0]);a(unescape(d[1]),f)}}function c(a){a&&f(a)&&(h.cookie=escape(a)+"\x3d; expires\x3dThu, 01 Jan 1970 00:00:00 GMT; path\x3d/")}function f(a){return(new RegExp("(?:^|;\\s*)"+escape(a).replace(/[\-\.\+\*]/g,"\\$\x26")+"\\s*\\\x3d")).test(h.cookie)}b=b("../src/util");d=b.Global;var e=b.trim;g.exports={name:"cookieStorage",read:function(a){if(!a||!f(a))return null;a="(?:^|.*;\\s*)"+escape(a).replace(/[\-\.\+\*]/g,"\\$\x26")+"\\s*\\\x3d\\s*((?:[^;](?!;))*[^;]?).*";return unescape(h.cookie.replace(new RegExp(a),
"$1"))},write:function(a,b){a&&(h.cookie=escape(a)+"\x3d"+escape(b)+"; expires\x3dTue, 19 Jan 2038 03:14:07 GMT; path\x3d/")},each:a,remove:c,clearAll:function(){a(function(a,b){c(b)})}};var h=d.document},{"../src/util":3}],5:[function(b,g,d){function a(a){return c.localStorage.getItem(a)}var c=b("../src/util").Global;g.exports={name:"localStorage",read:a,write:function(a,b){return c.localStorage.setItem(a,b)},each:function(b){for(var d=c.localStorage.length-1;0<=d;d--){var f=c.localStorage.key(d);
b(a(f),f)}},remove:function(a){return c.localStorage.removeItem(a)},clearAll:function(){return c.localStorage.clear()}}},{"../src/util":3}],6:[function(b,g,d){g.exports={name:"memoryStorage",read:function(b){return a[b]},write:function(b,d){a[b]=d},each:function(b){for(var c in a)a.hasOwnProperty(c)&&b(a[c],c)},remove:function(b){delete a[b]},clearAll:function(b){a={}}};var a={}},{}],7:[function(b,g,d){function a(a){return c.sessionStorage.getItem(a)}var c=b("../src/util").Global;g.exports={name:"sessionStorage",
read:a,write:function(a,b){return c.sessionStorage.setItem(a,b)},each:function(b){for(var d=c.sessionStorage.length-1;0<=d;d--){var e=c.sessionStorage.key(d);b(a(e),e)}},remove:function(a){return c.sessionStorage.removeItem(a)},clearAll:function(){return c.sessionStorage.clear()}}},{"../src/util":3}]},{},[1])(1)}).call(this,b(14))},function(k,h,b){function l(b,g){for(var d=0;d<g.length;d++){var a=g[d];a.enumerable=a.enumerable||!1;a.configurable=!0;"value"in a&&(a.writable=!0);Object.defineProperty(b,
a.key,a)}}b.r(h);var p=b(0);k=b(1);b=function(){function b(){if(!(this instanceof b))throw new TypeError("Cannot call a class as a function");!0;p.default.create("tmg.utils");tmg.utils={injectScript:this.inject}}var g;return g=[{key:"inject",value:function(b){var a=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];return new Promise(function(c,d){b?(d=document.createElement("script"),d.setAttribute("src",b),d.addEventListener("load",c,!1),a&&d.setAttribute("defer","true"),document.querySelector("head").appendChild(d)):
d(Error("No src supplied"))})}}],l(b.prototype,g),b}();k.a.subscribe({topic:"tmg.page.ready",func:new b,runIfAlreadyPublished:!0});h.default=b},,function(k,h,b){function l(b,d){for(var a=0;a<d.length;a++){var c=d[a];c.enumerable=c.enumerable||!1;c.configurable=!0;"value"in c&&(c.writable=!0);Object.defineProperty(b,c.key,c)}}b.r(h);k=b(1);var p=b(0),e=b(2);b=function(){function b(){if(!(this instanceof b))throw new TypeError("Cannot call a class as a function");!0;this.params={local:"local",qa:"qa",
ci:"ci",staging:"staging",prod:"prod"};this.currentEnv=this.determineEnvironment();p.default.create("tmg.environment");tmg.environment={currentEnv:this.currentEnv,getEnvironment:this.getEnvironment,getList:this.getList,getTld:this.getTld,isCommentingTurnedOn:this.isCommentingTurnedOn,isHttps:this.isHttps,isLocal:this.isLocal,isProd:this.isProd}}var d;return d=[{key:"determineEnvironment",value:function(){var a=e.default.getLocation().hostname.split(".");return a.some(function(a){return"local"===a||
"127"===a||"localhost"===a})?this.getList().local:a.some(function(a){return/(^|-)ci[0-9]+$/i.test(a)})?this.getList().ci:a.some(function(a){return/(^|-)qa[0-9]+$/i.test(a)})?this.getList().qa:a.some(function(a){return/(^|-)staging(.*)$/i.test(a)})?this.getList().staging:this.getList().prod}},{key:"getList",value:function(){return this.params}},{key:"getEnvironment",value:function(){return this.currentEnv}},{key:"getTld",value:function(){return"telegraph.co.uk"}},{key:"isCommentingTurnedOn",value:function(){var a=
!1;try{void 0!==tmg.COMMENTING_STATUS&&(a=!!tmg.COMMENTING_STATUS)}catch(c){console.log(c)}return a}},{key:"isHttps",value:function(){return"https:"===e.default.getLocation().protocol||this.isLocal()}},{key:"isLocal",value:function(){return this.getEnvironment()===this.getList().local}},{key:"isProd",value:function(){return this.getEnvironment()===this.getList().prod}}],l(b.prototype,d),b}();k.a.subscribe({topic:"tmg.page.ready",func:new b,runIfAlreadyPublished:!0});h.default=b},,,function(k,h){h=
function(){return this}();try{h=h||(new Function("return this"))()}catch(b){"object"==typeof window&&(h=window)}k.exports=h},,,,function(k,h,b){function l(b,d){for(var a=0;a<d.length;a++){var c=d[a];c.enumerable=c.enumerable||!1;c.configurable=!0;"value"in c&&(c.writable=!0);Object.defineProperty(b,c.key,c)}}var p=b(0),e=b(7);k=b(1);b=function(){function b(){if(!(this instanceof b))throw new TypeError("Cannot call a class as a function");!0;this.redirectSelector="[data-redirect-current]"}var d;return d=
[{key:"init",value:function(){var a=document.querySelectorAll(this.redirectSelector);a.length&&this.setRedirects(a);p.default.create("tmg.redirect");window.tmg.redirect={getAmendedHref:this.getAmendedHref}}},{key:"setRedirects",value:function(a){var b=this;a.forEach(function(a){var c=a.getAttribute("href");c&&a.setAttribute("href",b.getAmendedHref(c))})}},{key:"getAmendedHref",value:function(a){return-1<a.indexOf("redirectTo")?e.default.updateRedirectParam(a,window.location.href):e.default.setQuerystringParam(a,
"redirectTo",window.location.href)}}],l(b.prototype,d),b}();k.a.subscribe({topic:"tmg.page.ready",func:(new b).init(),runIfAlreadyPublished:!0});h.a=new b},,,,,,,,,,,,function(k,h,b){function l(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}function p(a){var b;(b=function(a){if(Array.isArray(a))return e(a)}(a))||(b="undefined"!=typeof Symbol&&Symbol.iterator in Object(a)?Array.from(a):void 0);
if(!(a=b||function(a,b){if(a){if("string"==typeof a)return e(a,b);var c=Object.prototype.toString.call(a).slice(8,-1);"Object"===c&&a.constructor&&(c=a.constructor.name);if("Map"===c||"Set"===c)return Array.from(a);if("Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c))return e(a,b)}}(a)))throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");return a}function e(a,b){(null==b||b>a.length)&&
(b=a.length);for(var c=0,d=Array(b);c<b;c++)d[c]=a[c];return d}function g(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}b.r(h);var d=b(11),a=b(1),c=b(2),f=b(6),q=b(9),u=b(3),n=function(){function b(){if(!(this instanceof b))throw new TypeError("Cannot call a class as a function");!0;this.envsConf={dev:{pianoLibraryUrl:"https://sandbox.tinypass.com/xbuilder/experience/load?aid\x3dnXCLFFIWmQ",
identityAPI:"https://api-preprod.telegraph.co.uk/identity-api-uat/identity/tokens"},staging:{pianoLibraryUrl:"https://sandbox.tinypass.com/xbuilder/experience/load?aid\x3dAdcpxkpRsu",identityAPI:"https://api-preprod.telegraph.co.uk/identity-api-qa/identity/tokens"},prod:{pianoLibraryUrl:"https://experience.tinypass.com/xbuilder/experience/load?aid\x3dNJu5KnOFpu",identityAPI:"https://api.telegraph.co.uk/identity/tokens"}};this.isArticle=c.default.isArticle();this.isGallery=c.default.isGallery();this.isPremium=
c.default.isPremium();this.pianoToken=f.default.getPianoRefToken();this.userLoggedIn=f.default.isLoggedIn();this.userSubscriber=f.default.isSubscriber();this.env=new d.default;this.currentEnv=this.env.getEnvironment();this.init()}var e;return e=[{key:"init",value:function(){this.isPremium&&(this.isArticle||this.isGallery)&&(this.userLoggedIn?this.pianoToken?this.loadPianoConfig(this.pianoToken):this.getNewPianoToken():this.loadPianoConfig())}},{key:"getEndpoints",value:function(a){return"prod"===
a||"staging"===a?this.envsConf[a]:this.envsConf.dev}},{key:"userIsBot",value:function(){return-1!==navigator.userAgent.search(/([Ff]acebookexternalhit]|[Gg]oogle)/g)}},{key:"loadPianoLibrary",value:function(){(new q.default).inject(this.getEndpoints(this.currentEnv).pianoLibraryUrl)}},{key:"loadPianoConfig",value:function(){var b=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",c=this.getPianoData();window.tp=window.tp||[];window.tp.push(["setUserRef",b]);window.tp.push(["setTags",this.getModifiedKeywords()]);
window.tp.push(["addHandler","meterActive",function(b){window.tmg&&(a.a.publish({topic:"tmg.piano.paywall.web_no_paywall"}),window.tmg.paywallMetering=b)}]);Object.keys(c).forEach(function(a){window.tp.push(["setCustomVariable",a,c[a]])});this.loadPianoLibrary()}},{key:"getModifiedKeywords",value:function(){return c.default.getKeywords().map(function(a){return a.toLowerCase().replace(/ /g,"-")})}},{key:"dateConversion",value:function(a){return Math.abs(new Date(1E3*a)-new Date)/864E5}},{key:"getPianoData",
value:function(){return{platform:"web",isPremium:this.isPremium,isArticle:this.isArticle,isGallery:this.isGallery,articleId:c.default.getArticleId(),channel:c.default.getChannel(),sectionId:c.default.getCategory(),isUserBot:this.userIsBot()}}},{key:"getNewPianoToken",value:function(){var a=this,b=f.default.getRefreshToken(),c={grant_type:"refresh_token",refresh_token:b,client_id:"tcuk"};if(!b||""===b)return"";fetch(this.getEndpoints(this.currentEnv).identityAPI,{method:"POST",body:JSON.stringify(c),
headers:{"Content-Type":"application/json",ddgFlow:"transformation_login",ddgAction:"refresh_token_article"}}).then(function(b){200===b.status||201===b.status?b.json().then(function(b){u.a.set("user_ref_token",b.user_ref_token,{expires:a.dateConversion(b.user_ref_token_expires_in)});a.loadPianoConfig(b.user_ref_token)}):a.loadPianoConfig()}).catch(function(){a.loadPianoConfig()})}}],l(b.prototype,e),b}();a.a.subscribe({topic:"tmg.page.ready",func:function(){new n},runIfAlreadyPublished:!0});k=b(0);
var t=b(18),m=function(){function b(){if(!(this instanceof b))throw new TypeError("Cannot call a class as a function");!0;this.charsLimit=100;this.liveStreamBlock=!1;this.galleryComponent=document.querySelector(".gallery.component");this.galleryContainer=document.querySelector(".gallery--wall-container");this.articleBody=document.querySelector('[data-js\x3d"article-body"]');this.liveStreamContainer=document.querySelector(".js-live-stream.component");this.template={loginLink:t.a.getAmendedHref("https://secure.telegraph.co.uk/secure/login/?ICID\x3ddefault_paywall_v-standard_monthly-login\x26redirectTo\x3d"),
subscribeLink:t.a.getAmendedHref("https://www.telegraph.co.uk/customer/subscribe?ICID\x3ddefault_paywall_v-standard_monthly-offer\x26redirectTo\x3d")}}var d;return d=[{key:"init",value:function(){c.default.isArticle()?this.articleTruncation():c.default.isGallery()&&this.createPaywallGallery()}},{key:"articleTruncation",value:function(){var a=p(this.articleBody.querySelectorAll("p")),b=this.getTruncatedParagraph(a);if(b||(this.liveStreamBlock=!0,a=p(this.liveStreamContainer.querySelectorAll("p")),
b=this.getTruncatedParagraph(a)),b){a=b.closest(".component-content");var c=this.liveStreamContainer?b.closest(".js-live-post.component"):b.closest(".section");c||(c=b.closest(".section"));this.removeNextElements([b,c]);this.addPaywallElements(a,["premium-end-content"]);this.createPaywallArticle()}}},{key:"createPaywallArticle",value:function(){this.addPaywallElements(this.liveStreamBlock?this.liveStreamContainer:this.articleBody,["premium-paywall","component"],'\x3cdiv class\x3d"component-content"\x3e\x3c/div\x3e');
this.injectPaywall()}},{key:"createPaywallGallery",value:function(){this.galleryComponent.classList.add("gallery--wall");this.addPaywallElements(this.galleryContainer,["premium-paywall","component"],'\x3cdiv class\x3d"component-content"\x3e\x3c/div\x3e');this.injectPaywall()}},{key:"removeNextElements",value:function(){(0<arguments.length&&void 0!==arguments[0]?arguments[0]:[]).forEach(function(a){for(;a.nextElementSibling;){var b=a.nextElementSibling;b.parentNode.removeChild(b)}})}},{key:"addPaywallElements",
value:function(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[],c=2<arguments.length&&void 0!==arguments[2]&&arguments[2],d=document.createElement("div");b.forEach(function(a){d.classList.add(a)});c&&(d.innerHTML=c);a&&a.appendChild(d)}},{key:"getTruncatedParagraph",value:function(a){var b=this,c=0,d=!1,e=!1;return a.forEach(function(a){if(c+a.textContent.trim().length>=b.charsLimit&&!d){var f=b.charsLimit-c,g=a.textContent.trim().split(" ").slice(0,f);g=g.join(" ")+"...";a.textContent=
g;e=a;c+=f;d=!0}else c+=a.textContent.trim().length}),e}},{key:"injectPaywall",value:function(){var b=document.querySelector(".premium-paywall.component .component-content"),c='\n\t\t\t\x3cdiv class\x3d"default-paywall default-paywall--anon default-paywall--standard"\x3e\n\t\t\t\t\x3cdiv class\x3d"default-paywall__header"\x3e\n\t\t\t\t\t\x3cdiv class\x3d"default-paywall__headings"\x3e\n\t\t\t\t\t\t\x3ch3 class\x3d"default-paywall__heading u-heading-5"\x3eTo continue reading\x3c/h3\x3e\n\t\t\t\t\t\t\x3ch4 class\x3d"default-paywall__sub-heading"\x3e\x3cspan\x3eAlready a subscriber?\x3c/span\x3e\n\t\t\t\t\t\t\t\x3ca href\x3d"'.concat(this.template.loginLink,
'" class\x3d"default-paywall__textlink default-paywall__login"\x3eLog in\x3c/a\x3e\n\t\t\t\t\t\t\x3c/h4\x3e\n\t\t\t\t\t\x3c/div\x3e\n\t\t\t\t\x3c/div\x3e\n\t\t\t\t\x3cdiv class\x3d"default-paywall__products"\x3e\n\t\t\t\t\t\x3cdiv class\x3d"default-paywall__product default-paywall__product-subscribe"\x3e\n\t\t\t\t\t\t\x3cdiv class\x3d"default-paywall__product-content"\x3e\n\t\t\t\t\t\t\t\x3cul class\x3d"default-paywall__product-features"\x3e\n\t\t\t\t\t\t\t\t\x3cli class\x3d"default-paywall__product-feature"\x3eEnjoy unlimited access to all articles\x3c/li\x3e\n\t\t\t\t\t\t\t\t\x3cli class\x3d"default-paywall__product-feature"\x3eChoose from all our exclusive newsletters\x3c/li\x3e\n\t\t\t\t\t\t\t\t\x3cli class\x3d"default-paywall__product-feature"\x3eUnlock money-saving offers and events\x3c/li\x3e\n\t\t\t\t\t\t\t\x3c/ul\x3e\n\t\t\t\t\t\t\x3c/div\x3e\n\t\t\t\t\t\t\x3ca class\x3d"default-paywall__product-cta\n\t\t\t\t\t\t\t\te-button\n\t\t\t\t\t\t\t\te-button--centered-text\n\t\t\t\t\t\t\t\te-button--large"\n\t\t\t\t\t\t\thref\x3d"').concat(this.template.subscribeLink,
'"\x3eSubscribe\x3c/a\x3e\n\t\t\t\t\t\x3c/div\x3e\n\t\t\t\t\x3c/div\x3e\n\t\t\t\x3c/div\x3e');b&&(b.innerHTML=c,a.a.publish({topic:"tmg.page.pianoready"}))}}],g(b.prototype,d),b}();b=new m;k.default.create("tmg.PianoPaywall");tmg.PianoPaywall=b;h.default={piano:n,pianoPaywall:m}}],[[30,1,0]]]);