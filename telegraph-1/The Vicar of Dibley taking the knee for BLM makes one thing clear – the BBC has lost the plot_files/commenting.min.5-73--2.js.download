(window["tmg.build"]=window["tmg.build"]||[]).push([[6,7,9,14,16,20,25,26],[,,function(l,m,a){function n(f,a){for(var d=0;d<a.length;d++){var c=a[d];c.enumerable=c.enumerable||!1;c.configurable=!0;"value"in c&&(c.writable=!0);Object.defineProperty(f,c.key,c)}}a.r(m);var t=a(0);l=a(1);a=function(){function f(){if(!(this instanceof f))throw new TypeError("Cannot call a class as a function");!0;t.default.create("tmg.page");tmg.page={getMetaTag:this.getMetaTag,getMetaContent:this.getMetaContent,getPageType:this.getPageType,
getChannel:this.getChannel,getBusinessSegment:this.getBusinessSegment,getCategory:this.getCategory,getContentType:this.getContentType,getArticleId:this.getArticleId,getPublishDate:this.getPublishDate,getKeywords:this.getKeywords,getLocation:this.getLocation,getLeadAssetLayout:this.getLeadAssetLayout,isArticle:this.isArticle,isSponsored:this.isSponsored,isGallery:this.isGallery,isPremium:this.isPremium,isApp:this.isApp}}var a;return a=[{key:"getPageType",value:function(){return window.dataLayer&&window.dataLayer.pageType}},
{key:"getChannel",value:function(){return this.getMetaContent("tmgads.channel")}},{key:"getCategory",value:function(){return this.getMetaContent("DCSext.Category")}},{key:"getBusinessSegment",value:function(){return this.getMetaContent("tmgads.businessSegment")}},{key:"getContentType",value:function(){return this.getMetaContent("DCSext.Content_Type")}},{key:"getArticleId",value:function(){return this.getMetaContent("tmgads.articleid")}},{key:"getPublishDate",value:function(){return this.getMetaContent("DCSext.articleFirstPublished")}},
{key:"getKeywords",value:function(){return this.getMetaContent("keywords").split(",").map(function(d){return d.trim()})}},{key:"getLocation",value:function(){return document.location}},{key:"getMetaContent",value:function(d){var c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"content",g=this.getMetaTag(d),k="generic";return g&&g.getAttribute(c)&&(k=g.getAttribute(c)),k}},{key:"getMetaTag",value:function(d){return document.querySelector("meta[name\x3d'".concat(d,"']"))}},{key:"isArticle",
value:function(){var d=this,c=!1;return["articleRenderer","articleRenderer2"].forEach(function(g){d.getPageType()===g&&(c=!0)}),c}},{key:"isGallery",value:function(){return"galleryRenderer"===this.getPageType()}},{key:"isSponsored",value:function(){return"sponsored"===this.getBusinessSegment()}},{key:"isPremium",value:function(){return"true"===this.getMetaContent("tmg.premium.state")}},{key:"isApp",value:function(){return"true"===this.getMetaContent("tmg.app")}},{key:"isAuthor",value:function(){return document.documentElement.hasAttribute("data-is-author")}},
{key:"getLeadAssetLayout",value:function(){return this.isArticle()&&document.querySelector("[data-lead-asset-layout]")?document.querySelector("[data-lead-asset-layout]").dataset.leadAssetLayout:this.isArticle()?"hidden":void 0}}],n(f.prototype,a),f}();l.a.subscribe({topic:"tmg.page.ready",func:new a,runIfAlreadyPublished:!0});m.default=new a},function(l,m,a){function n(){for(var a=0,f={};a<arguments.length;a++){var h=arguments[a],d;for(d in h)f[d]=h[d]}return f}m.a=function h(f){function d(c,g,k){if(1<
arguments.length){if("number"==typeof(k=n({path:"/"},d.defaults,k)).expires){var a=new Date;a.setMilliseconds(a.getMilliseconds()+864E5*k.expires);k.expires=a}try{var r=JSON.stringify(g);/^[\{\[]/.test(r)&&(g=r)}catch(v){}return g=(g=encodeURIComponent(String(g))).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),c=(c=(c=encodeURIComponent(String(c))).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent)).replace(/[\(\)]/g,escape),document.cookie=[c,"\x3d",g,
k.expires&&"; expires\x3d"+k.expires.toUTCString(),k.path&&"; path\x3d"+k.path,k.domain&&"; domain\x3d"+k.domain,k.secure?"; secure":""].join("")}c||(r={});a=document.cookie?document.cookie.split("; "):[];for(var p=/(%[0-9A-Z]{2})+/g,b=0;b<a.length;b++){var e=a[b].split("\x3d"),h=e[0].replace(p,decodeURIComponent);e=e.slice(1).join("\x3d");'"'===e.charAt(0)&&(e=e.slice(1,-1));try{if(e=f&&f(e,h)||e.replace(p,decodeURIComponent),this.json)try{e=JSON.parse(e)}catch(v){}if(c===h){r=e;break}c||(r[h]=e)}catch(v){}}return r}
return d.get=d.set=d,d.getJSON=function(){return d.apply({json:!0},[].slice.call(arguments))},d.defaults={},d.remove=function(c,g){d(c,"",n(g,{expires:-1}))},d.withConverter=h,d}()},function(l,m,a){a.r(m);l=a(0);a={};var n=function(a){var d={};return"string"==typeof a&&(d=t(a.replace(/'/g,'"'))),d},t=function(a,d){d=d||{};var c=a,g=[],k=[],q=/[{?,\s]\s*"([^"]|\\")+"\s*:(\s*"([^"]|\\")+"|(.+))\s*[},]/gi,r=/^\s*{?\s*'|'\s*}?\s*$/i;if(!a)return d;if("[object Object]"===Object.prototype.toString.call(a))return a;
if(f(c)||((c.match(q)||[]).forEach(function(a){if(a.includes('"label"')){var b=a.replace(/^\s*[{\s]|[,}]\s*$/gi,"").split(":")[1].replace(/\s*"([^]+|\\")"\s*$/gi,"$1"),e=b.replace(/"/gi,'\\"');b=a.replace(b,e);c=c.replace(a,b)}}),g=c.replace(q,"").split(/,(?=(?:[^"]*"[^"]*")*[^"]*$)/)),g.forEach(function(a){a=a.replace(/^\s*{|}\s*$/gi,"");f("{".concat(a,"}"))||k.push(a)}),k.forEach(function(a){var b=!1,e=a;!0===r.test(a)&&(e=a.replace(/^\s*'([^']+|\\')':/,'"$1":').replace(/:\s*('')\s*$/,': ""').replace(/:\s*'([^']+|\\')'\s*$/,
': "$1"'),b=f("{".concat(e,"}")));b||!0!==/[^"']\w+[^"']:/.test(e)||(e=e.replace(/^\s*(.*?):/,'"$1":'),b=f("{".concat(e,"}")));b&&(c=c.replace(a,e))}),f(c))d=f(c);else try{JSON.parse(c)}catch(p){console.log("tmg.json.tryParse failed:",p)}return d},f=function(a){var d=!1;try{d=JSON.parse(a)}catch(c){}return d};a={parseFromAem:n,tryParse:t,simpleTryParse:f};l.default.create("tmg.json");tmg.json=a;m.default=a;tmg.parseAemJson=n},function(l,m,a){l=a(8);l=a.n(l);a(0).default.create("tmg.store");tmg.store=
l.a;m.a=l.a},function(l,m,a){a.r(m);var n=a(3),t=a(4);l=a(0);var f=a(5),h={pId:"",firstName:"",lastName:"",username:"",email:"",readerType:"",subscriber:"",subButton:""},d={livefyreToken:"livefyre-token",pianoRefToken:"user_ref_token",meterCount:"tmg_meter_count",personalisation:"tmg_p13n",publicId:"tmg_pid",registrationSuccess:"tmg_registration_success",rememberMe:"tmg_rem",session:"tmg_session",refreshToken:"tmg_refresh",subscriptionConfirmation:"tmg_subscription_confirmation"},c={},g=document.querySelector("html"),
k=function(){var b=document.querySelectorAll('[class*\x3d"'.concat("logged-in--",'"], [class*\x3d"').concat("is-subscriber--",'"]'));(b=Array.prototype.slice.call(b)).forEach(function(b){q(b,!0)})},q=function(e,a){if(a||k(),e)return a="\\b(?:".concat("logged-in--","|").concat("is-subscriber--",").+\\b"),e.className=e.className.replace(new RegExp(a,"g"),""),e.classList&&(e.classList.add("".concat("logged-in--").concat(p())),e.classList.add("".concat("is-subscriber--").concat(b()))),e.classList},r=
function(){var b=n.a.get(d.personalisation);return t.default.tryParse(b,h)},p=function(){return!!n.a.get(d.session)},b=function(){return"true"===c.subscriber},e=function(){return window.sessionStorage.removeItem("id_token"),window.sessionStorage.removeItem("access_token"),n.a.remove(d.session),u(),!0},u=function(){return c=r(),q(g),c};a={applyStatusCssClasses:q,clearAllData:function(){for(var b in e(),d)n.a.remove(d[b]);return f.a.remove("fyre-auth"),f.a.remove("fyre-authentication-creds"),u(),!0},
getLiveFyreToken:function(){return n.a.get(d.livefyreToken)||!1},getLiveFyreDetails:function(){var b=f.a.get("fyre-auth")||"{}";return t.default.tryParse(b)},getPianoRefToken:function(){return n.a.get(d.pianoRefToken)||!1},getMeterCount:function(){return!1},getMyTelegraphToken:function(){var b=f.a.storage.read("tmg.user.mytelegraph.token");return"undefined"!==b&&null!==b||(b=!1),b},getProfile:r,getSessionId:function(){return n.a.get(d.session)||""},getRefreshToken:function(){return n.a.get(d.refreshToken)||
""},isLoggedIn:p,isRegistered:function(){return!!c.pId},isSubscriber:b,canComment:function(){return"true"===c.subscriber&&!!n.a.get(d.session)},isMyTelegraphOnboarded:function(){return!!f.a.storage.read("tmg.user.mytelegraph.onboarded.status")},login:function(){return u(),!1},logout:e,setMyTelegraphToken:function(b){return f.a.storage.write("tmg.user.mytelegraph.token",b.token)},setMyTelegraphOnboarded:function(b){return f.a.storage.write("tmg.user.mytelegraph.onboarded.status",b.status)},updateState:u};
l.default.create("tmg.user");window.tmg.user=a;c=u();m.default=a},function(l,m,a){a.r(m);var n;l=a(0);var t=a(2),f=new RegExp(/\?[^#]*|(?=#)|$/),h=(n={},function(a){return n[a]||(n[a]=new RegExp("([?\x26;]".concat(a,"(?\x3d[\x3d\x26;#]|$))\x3d?([^\x26;#]*)")))}),d=function(a,c){return(a=h(c).exec(a))&&decodeURIComponent(a[2])},c=function(a,c,g){var k,b,e;return void 0===a&&(a=t.default.getLocation().search),null===d(a,c)?(k="".concat(c,"\x3d").concat(encodeURIComponent(g)),b=f.exec(a)[0],e=a.replace(f,
(b.length?b+"\x26":"?")+k)):e=a.replace(h(c),"$1\x3d".concat(encodeURIComponent(g))),e};a=function(a,c){if(null!==d(c,a)){var g=c.split("?")[0];c=(-1!==c.indexOf("?")?c.split("?")[1]:"").split("\x26");for(var f=c.length-1;0<=f;--f)c[f].split("\x3d")[0]===a&&c.splice(f,1);return g+(0<c.length?"?":"")+c.join("\x26")}return c};var g=function(a,g){return null!==d(a,"redirectTo")?c(a,"redirectTo",g):a};l.default.create("tmg.GET_PARAM");tmg.getQuerystringParam=d;tmg.setQuerystringParam=c;tmg.removeQuerystringParam=
a;tmg.updateRedirectParam=g;location.search.substr(1).split("\x26").forEach(function(a){a=a.split("\x3d");1<a.length?tmg.GET_PARAM[a[0]]=decodeURIComponent(a[1]):tmg.GET_PARAM[a[0]]=""});m.default={matchParam:h,matchQuerystring:f,getQuerystringParam:d,removeQuerystringParam:a,setQuerystringParam:c,updateRedirectParam:g}},function(l,m,a){(function(a){l.exports=function c(a,h,d){function g(k,p){if(!h[k]){if(!a[k]){if(f)return f(k,!0);p=Error("Cannot find module '"+k+"'");throw p.code="MODULE_NOT_FOUND",
p;}p=h[k]={exports:{}};a[k][0].call(p.exports,function(b){return g(a[k][1][b]||b)},p,p.exports,c,a,h,d)}return h[k].exports}for(var f=!1,q=0;q<d.length;q++)g(d[q]);return g}({1:[function(a,h,d){d=a("../src/store-engine");a=[a("../storages/localStorage"),a("../storages/sessionStorage"),a("../storages/cookieStorage"),a("../storages/memoryStorage")];h.exports=d.createStore(a,[])},{"../src/store-engine":2,"../storages/cookieStorage":4,"../storages/localStorage":5,"../storages/memoryStorage":6,"../storages/sessionStorage":7}],
2:[function(a,h,d){function c(a,c,d){d||(d="");a&&!b(a)&&(a=[a]);c&&!b(c)&&(c=[c]);var h=d?"__storejs_"+d+"_":"",w=d?new RegExp("^"+h):null;if(!/^[a-zA-Z0-9_\-]*$/.test(d))throw Error("store.js namespaces can only have alphanumerics + underscores and dashes");var q=p({_namespacePrefix:h,_namespaceRegexp:w,_testStorage:function(a){try{a.write("__storejs__test__","__storejs__test__");var b="__storejs__test__"===a.read("__storejs__test__");return a.remove("__storejs__test__"),b}catch(x){return!1}},_assignPluginFnProp:function(a,
b){var e=this[b];this[b]=function(){var b=g(arguments,0),c=this,d=[function(){if(e)return f(arguments,function(a,e){b[e]=a}),e.apply(c,b)}].concat(b);return a.apply(c,d)}},_serialize:function(a){return JSON.stringify(a)},_deserialize:function(a,b){if(!a)return b;var e="";try{e=JSON.parse(a)}catch(y){e=a}return void 0!==e?e:b},_addStorage:function(a){this.enabled||this._testStorage(a)&&(this.storage=a,this.enabled=!0)},_addPlugin:function(a){var c=this;if(b(a))f(a,function(a){c._addPlugin(a)});else if(!k(this.plugins,
function(b){return a===b})){if(this.plugins.push(a),!e(a))throw Error("Plugins must be function values that return objects");var d=a.call(this);if(!u(d))throw Error("Plugins must return an object of function properties");f(d,function(b,d){if(!e(b))throw Error("Bad plugin property: "+d+" from plugin "+a.name+". Plugins should only return functions.");c._assignPluginFnProp(b,d)})}},addStorage:function(a){(function(){var a="undefined"==typeof console?null:console;a&&(a.warn?a.warn:a.log).apply(a,arguments)})("store.addStorage(storage) is deprecated. Use createStore([storages])");
this._addStorage(a)}},v,{plugins:[]});return q.raw={},f(q,function(a,b){e(a)&&(q.raw[b]=r(q,a))}),f(a,function(a){q._addStorage(a)}),f(c,function(a){q._addPlugin(a)}),q}a=a("./util");var g=a.slice,k=a.pluck,f=a.each,r=a.bind,p=a.create,b=a.isList,e=a.isFunction,u=a.isObject;h.exports={createStore:c};var v={version:"2.0.12",enabled:!1,get:function(a,b){a=this.storage.read(this._namespacePrefix+a);return this._deserialize(a,b)},set:function(a,b){return void 0===b?this.remove(a):(this.storage.write(this._namespacePrefix+
a,this._serialize(b)),b)},remove:function(a){this.storage.remove(this._namespacePrefix+a)},each:function(a){var b=this;this.storage.each(function(e,c){a.call(b,b._deserialize(e),(c||"").replace(b._namespaceRegexp,""))})},clearAll:function(){this.storage.clearAll()},hasNamespace:function(a){return this._namespacePrefix=="__storejs_"+a+"_"},createStore:function(){return c.apply(this,arguments)},addPlugin:function(a){this._addPlugin(a)},namespace:function(a){return c(this.storage,this.plugins,a)}}},
{"./util":3}],3:[function(f,h,d){(function(a){function c(a,b){return Array.prototype.slice.call(a,b||0)}function d(a,b){f(a,function(a,e){return b(a,e),!1})}function f(a,b){if(r(a))for(var e=0;e<a.length;e++){if(b(a[e],e))return a[e]}else for(e in a)if(a.hasOwnProperty(e)&&b(a[e],e))return a[e]}function r(a){return null!=a&&"function"!=typeof a&&"number"==typeof a.length}var p=Object.assign?Object.assign:function(a,b,c,g){for(var e=1;e<arguments.length;e++)d(Object(arguments[e]),function(b,e){a[e]=
b});return a},b=function(){if(Object.create)return function(a,b,e,d){var g=c(arguments,1);return p.apply(this,[Object.create(a)].concat(g))};var a=function(){};return function(b,e,d,g){var f=c(arguments,1);return a.prototype=b,p.apply(this,[new a].concat(f))}}();h.exports={assign:p,create:b,trim:String.prototype.trim?function(a){return String.prototype.trim.call(a)}:function(a){return a.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")},bind:function(a,b){return function(){return b.apply(a,Array.prototype.slice.call(arguments,
0))}},slice:c,each:d,map:function(a,b){var e=r(a)?[]:{};return f(a,function(a,c){return e[c]=b(a,c),!1}),e},pluck:f,isList:r,isFunction:function(a){return a&&"[object Function]"==={}.toString.call(a)},isObject:function(a){return a&&"[object Object]"==={}.toString.call(a)},Global:"undefined"!=typeof window?window:a}}).call(this,void 0!==a?a:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],4:[function(a,h,d){function c(a){for(var b=r.cookie.split(/; ?/g),e=b.length-1;0<=e;e--)if(q(b[e])){var c=
b[e].split("\x3d"),d=unescape(c[0]);a(unescape(c[1]),d)}}function g(a){a&&f(a)&&(r.cookie=escape(a)+"\x3d; expires\x3dThu, 01 Jan 1970 00:00:00 GMT; path\x3d/")}function f(a){return(new RegExp("(?:^|;\\s*)"+escape(a).replace(/[\-\.\+\*]/g,"\\$\x26")+"\\s*\\\x3d")).test(r.cookie)}a=a("../src/util");d=a.Global;var q=a.trim;h.exports={name:"cookieStorage",read:function(a){if(!a||!f(a))return null;a="(?:^|.*;\\s*)"+escape(a).replace(/[\-\.\+\*]/g,"\\$\x26")+"\\s*\\\x3d\\s*((?:[^;](?!;))*[^;]?).*";return unescape(r.cookie.replace(new RegExp(a),
"$1"))},write:function(a,b){a&&(r.cookie=escape(a)+"\x3d"+escape(b)+"; expires\x3dTue, 19 Jan 2038 03:14:07 GMT; path\x3d/")},each:c,remove:g,clearAll:function(){c(function(a,b){g(b)})}};var r=d.document},{"../src/util":3}],5:[function(a,h,d){function c(a){return g.localStorage.getItem(a)}var g=a("../src/util").Global;h.exports={name:"localStorage",read:c,write:function(a,c){return g.localStorage.setItem(a,c)},each:function(a){for(var d=g.localStorage.length-1;0<=d;d--){var f=g.localStorage.key(d);
a(c(f),f)}},remove:function(a){return g.localStorage.removeItem(a)},clearAll:function(){return g.localStorage.clear()}}},{"../src/util":3}],6:[function(a,h,d){h.exports={name:"memoryStorage",read:function(a){return c[a]},write:function(a,d){c[a]=d},each:function(a){for(var d in c)c.hasOwnProperty(d)&&a(c[d],d)},remove:function(a){delete c[a]},clearAll:function(a){c={}}};var c={}},{}],7:[function(a,h,d){function c(a){return g.sessionStorage.getItem(a)}var g=a("../src/util").Global;h.exports={name:"sessionStorage",
read:c,write:function(a,c){return g.sessionStorage.setItem(a,c)},each:function(a){for(var d=g.sessionStorage.length-1;0<=d;d--){var f=g.sessionStorage.key(d);a(c(f),f)}},remove:function(a){return g.sessionStorage.removeItem(a)},clearAll:function(){return g.sessionStorage.clear()}}},{"../src/util":3}]},{},[1])(1)}).call(this,a(14))},function(l,m,a){function n(a,h){for(var d=0;d<h.length;d++){var c=h[d];c.enumerable=c.enumerable||!1;c.configurable=!0;"value"in c&&(c.writable=!0);Object.defineProperty(a,
c.key,c)}}a.r(m);var t=a(0);l=a(1);a=function(){function a(){if(!(this instanceof a))throw new TypeError("Cannot call a class as a function");!0;t.default.create("tmg.utils");tmg.utils={injectScript:this.inject}}var h;return h=[{key:"inject",value:function(a){var c=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];return new Promise(function(d,f){a?(f=document.createElement("script"),f.setAttribute("src",a),f.addEventListener("load",d,!1),c&&f.setAttribute("defer","true"),document.querySelector("head").appendChild(f)):
f(Error("No src supplied"))})}}],n(a.prototype,h),a}();l.a.subscribe({topic:"tmg.page.ready",func:new a,runIfAlreadyPublished:!0});m.default=a},,function(l,m,a){function n(a,d){for(var c=0;c<d.length;c++){var g=d[c];g.enumerable=g.enumerable||!1;g.configurable=!0;"value"in g&&(g.writable=!0);Object.defineProperty(a,g.key,g)}}a.r(m);l=a(1);var t=a(0),f=a(2);a=function(){function a(){if(!(this instanceof a))throw new TypeError("Cannot call a class as a function");!0;this.params={local:"local",qa:"qa",
ci:"ci",staging:"staging",prod:"prod"};this.currentEnv=this.determineEnvironment();t.default.create("tmg.environment");tmg.environment={currentEnv:this.currentEnv,getEnvironment:this.getEnvironment,getList:this.getList,getTld:this.getTld,isCommentingTurnedOn:this.isCommentingTurnedOn,isHttps:this.isHttps,isLocal:this.isLocal,isProd:this.isProd}}var d;return d=[{key:"determineEnvironment",value:function(){var a=f.default.getLocation().hostname.split(".");return a.some(function(a){return"local"===a||
"127"===a||"localhost"===a})?this.getList().local:a.some(function(a){return/(^|-)ci[0-9]+$/i.test(a)})?this.getList().ci:a.some(function(a){return/(^|-)qa[0-9]+$/i.test(a)})?this.getList().qa:a.some(function(a){return/(^|-)staging(.*)$/i.test(a)})?this.getList().staging:this.getList().prod}},{key:"getList",value:function(){return this.params}},{key:"getEnvironment",value:function(){return this.currentEnv}},{key:"getTld",value:function(){return"telegraph.co.uk"}},{key:"isCommentingTurnedOn",value:function(){var a=
!1;try{void 0!==tmg.COMMENTING_STATUS&&(a=!!tmg.COMMENTING_STATUS)}catch(g){console.log(g)}return a}},{key:"isHttps",value:function(){return"https:"===f.default.getLocation().protocol||this.isLocal()}},{key:"isLocal",value:function(){return this.getEnvironment()===this.getList().local}},{key:"isProd",value:function(){return this.getEnvironment()===this.getList().prod}}],n(a.prototype,d),a}();l.a.subscribe({topic:"tmg.page.ready",func:new a,runIfAlreadyPublished:!0});m.default=a},function(l,m,a){function n(a,
c){for(var d=0;d<c.length;d++){var b=c[d];b.enumerable=b.enumerable||!1;b.configurable=!0;"value"in b&&(b.writable=!0);Object.defineProperty(a,b.key,b)}}a.r(m);var t=a(0);l=a(1);var f=a(3),h=a(6),d=a(2),c=a(7),g=a(4),k=function(){function a(){if(!(this instanceof a))throw new TypeError("Cannot call a class as a function");!0;t.default.create("tmg.dataLayerUtils");window.dataLayer=window.dataLayer||{};this.cookieStatus=this.getCookies();this.isPaymentRenderer=window.dataLayer.pageType&&"paymentRenderer"===
window.dataLayer.pageType;this.listenerEvents=["click","input"];this.initListeners("[data-layer-event]");tmg.dataLayerUtils={cookieStatus:this.cookieStatus,update:this.update,isPaymentRenderer:this.isPaymentRenderer,onRegistrationSuccess:this.onRegistrationSuccess,onRegistrationUpdate:this.onRegistrationUpdate,onSubscriptionConfirmation:this.onSubscriptionConfirmation,updateSubscription:this.updateSubscription,updateUserStatus:this.updateUserStatus,checkCookie:this.checkCookie,removeCookie:this.removeCookie,
addPropertyValue:this.addPropertyValue};this.update()}var k,p;return p=[{key:"addPropertyValue",value:function(a,e){a&&e&&(window.dataLayer[a]=e)}}],k=[{key:"update",value:function(){this.cookieStatus.registrationSuccess.value?(this.onRegistrationSuccess(),this.removeCookie(this.cookieStatus.registrationSuccess.name)):this.cookieStatus.registrationUpdate.value?(this.onRegistrationUpdate(),this.removeCookie(this.cookieStatus.registrationUpdate.name)):this.cookieStatus.subscriptionConfirmation.value?
(this.onSubscriptionConfirmation(),this.removeCookie(this.cookieStatus.subscriptionConfirmation.name)):this.isPaymentRenderer&&this.updateSubscription();this.updateUserStatus()}},{key:"updateUserStatus",value:function(){h.default.isLoggedIn()?window.dataLayer.userStatus=h.default.isSubscriber()?"subscribed":"registered":window.dataLayer.userStatus="anonymous"}},{key:"onRegistrationSuccess",value:function(){var a=this.checkCookie(this.cookieStatus.registrationSuccess,"success_facebook"),e=this.checkCookie(this.cookieStatus.registrationSuccess,
"success_emailoffers-true");window.dataLayer.event=["registrationComplete"];window.dataLayer.registration={registrationType:a?"facebook":"email",emailOptIn:e?"true":"false"}}},{key:"onRegistrationUpdate",value:function(){"1"!==this.cookieStatus.registrationUpdate.value?(window.dataLayer.event=["registrationUpdate","newsletterSignup"],window.dataLayer.newsletterType=this.cookieStatus.registrationUpdate.value):window.dataLayer.event=["registrationUpdate"];window.dataLayer.registration={registrationType:"email"}}},
{key:"onSubscriptionConfirmation",value:function(){window.dataLayer.event=["subscriptionConfirmation"];window.dataLayer.subscription=g.default.tryParse(JSON.stringify(this.cookieStatus.subscriptionConfirmation.value))}},{key:"updateSubscription",value:function(){window.dataLayer.event=["subscriptionCheckout"];window.dataLayer.subscription={productID:c.default.getQuerystringParam(d.default.getLocation().search,"productId")}}},{key:"checkCookie",value:function(a,e){return!(!a||!e)&&a.value===e}},{key:"removeCookie",
value:function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;a&&f.a.remove(a,{domain:".telegraph.co.uk"})}},{key:"initListeners",value:function(a){var b=this;(a=document.querySelectorAll(a))&&a.forEach(function(a){return b.bindListeners(a)})}},{key:"bindListeners",value:function(a){var b=this;this.listenerEvents.forEach(function(c){a.addEventListener(c,function(a){b.addEvent(a.target.dataset.layerEvent)})})}},{key:"addEvent",value:function(a){window.dataLayer.event!==a&&(window.dataLayer.event=
a)}},{key:"getCookies",value:function(){return{registrationSuccess:{name:"tmg_registration_success",value:f.a.get("tmg_registration_success")},registrationUpdate:{name:"tmg_registration_update",value:f.a.get("tmg_registration_update")},subscriptionConfirmation:{name:"tmg_subscription_confirmation",value:f.a.get("tmg_subscription_confirmation")}}}}],n(a.prototype,k),p&&n(a,p),a}();l.a.subscribe({topic:"tmg.page.ready",func:function(){new k},runIfAlreadyPublished:!0});m.default=k},,function(l,m){m=
function(){return this}();try{m=m||(new Function("return this"))()}catch(a){"object"==typeof window&&(m=window)}l.exports=m},,,,,,,,,,,,,,,,,function(l,m,a){function n(a,c){for(var b=0;b<c.length;b++){var e=c[b];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(a,e.key,e)}}function t(a,c){for(var b=0;b<c.length;b++){var e=c[b];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(a,e.key,e)}}a.r(m);l=a(1);
var f=a(9),h=a(4),d=a(6),c=a(11),g=a(12),k=function(){function a(b){if(!(this instanceof a))throw new TypeError("Cannot call a class as a function");!0;this.config=b}var c;return c=[{key:"initCounts",value:function(){var a=this;if(this.config){var c=this.config.convConfig,d=c.siteId,f=c.articleId;c=this.getCommentCountUrl(d,f);var g=localStorage.getItem("tmg.commenting.count-".concat(f));g&&(this.renderCommentCount(g),this.showComment());this.getCommentCount(c,d,f).then(function(b){b&&(localStorage.setItem("tmg.commenting.count-".concat(f),
b),b=a.checkMaxCommentToDisplay(b),a.renderCommentCount(b),a.showComment())})}}},{key:"getCommentCountUrl",value:function(a,c){var b="telegraphmedia".concat("prod"===this.config.environment.getEnvironment()?"":"-int");b="https://".concat(b,".bootstrap.fyre.co/api/v1.1/public/comments/ncomments/");a=btoa("".concat(a,":").concat(c));return"".concat(b).concat(a,".json")}},{key:"getCommentCount",value:function(a,c,d){var b=this;return window.fetch(a).then(function(a){return 200<=a.status&&300>a.status?
Promise.resolve(a):Promise.reject(Error(a.statusText))}).then(function(a){return a.json()}).then(function(a){return b.checkValidResponse(a,c,d)},function(a){return console.log("error getting data from livefyre",a),!1})}},{key:"checkValidResponse",value:function(a,c,d){a=a.data[c]||!1;return a[d]&&a[d].livefyre?a[d].livefyre:void 0}},{key:"renderCommentCount",value:function(a){document.querySelectorAll('[data-js\x3d"comment-count"]').forEach(function(b){b.innerHTML="".concat(a)});g.default.addPropertyValue("comments",
a)}},{key:"checkMaxCommentToDisplay",value:function(a){return 9999<a?"10k +":a}},{key:"showComment",value:function(){document.querySelectorAll('[data-js\x3d"e-comment-count"]').forEach(function(a){a.classList.remove("e-comment-count--hidden")})}}],n(a.prototype,c),a}(),q=function(){function a(){if(!(this instanceof a))throw new TypeError("Cannot call a class as a function");!0;var b=this.validateConfig(document.querySelector("[data-comment-config]"));if(b){var e=Object.assign(b.networkConfig,{strings:{postEditButton:"Update comment",
postEditAsButton:"Update comment",postAsButton:"Post comment",showMore:"Show more"}}),f=new c.default;this.config={networkConfig:e,convConfig:b.convConfig,user:d.default,environment:f,loadButton:document.querySelectorAll('[data-js\x3d"comment-load"]'),loadLabelElem:document.querySelector("[data-label-loading]"),commentContainer:document.querySelector('[data-js\x3d"comment"]'),loadedStatus:!1,deleteLinks:document.querySelectorAll(".fyre-delete-link"),authDetails:localStorage.getItem("fyre-auth"),commentCount:"/api/v1.1/public/comments/ncomments/"};
b={readOnly:!this.config.user.canComment(),el:"comment__livefyre",disableAvatars:!0,datetimeFormat:{minutesUntilAbsoluteTime:-1,absoluteFormat:"d MMM yyyy h:mma"},initialNumVisible:5};b=Object.assign(this.config.convConfig,b);this.config.convConfig=b;b={readOnly:!this.config.user.canComment(),el:"comment__livefyre",disableAvatars:!0,datetimeFormat:{minutesUntilAbsoluteTime:-1,absoluteFormat:"d MMM yyyy h:mma"},initialNumVisible:5};b=Object.assign(this.config.convConfig,b);this.config.convConfig=b;
this.commentCount=new k(this.config);this.config.networkConfig&&this.config.convConfig&&(this.commentCount.initCounts(),this.bindEvents())}}var l;return l=[{key:"validateConfig",value:function(a){return!!a&&h.default.tryParse(a.dataset.commentConfig)}},{key:"bindEvents",value:function(){var a=this;this.config.loadButton.forEach(function(b){b.addEventListener("click",function(){a.loadLibrary();g.default.addPropertyValue("event",[b.dataset.event]);b.disabled=!0})});document.addEventListener("click",
function(a){a.target&&a.target.classList.contains("fyre-delete-link")&&g.default.addPropertyValue("event",["deletedComment"])})}},{key:"loadLibrary",value:function(){var a=this;this.config.loadedStatus||(new f.default).inject("//cdn.livefyre.com/Livefyre.js").then(function(){a.updateButtonLoadingText(a.config.loadLabelElem);a.initComments()})}},{key:"updateButtonLoadingText",value:function(a){a.innerHTML=a.dataset.labelLoading}},{key:"initComments",value:function(){var a=this;Livefyre.require(["fyre.conv#3",
"auth"],function(b,c){a.conv=new b(a.config.networkConfig,[a.config.convConfig],function(b){b.on("commentCountUpdated",a.commentCountUpdated.bind(a));b.on("commentPosted",function(a){a.parent?g.default.addPropertyValue("commentType","reply"):g.default.addPropertyValue("commentType","comment");g.default.addPropertyValue("event",["commented"])});b.on("showMore",g.default.addPropertyValue.bind(a,"event",["showMoreComments"]));b.on("initialRenderComplete",function(){a.openComments();a.commentCount.initCounts();
d.default.canComment()&&a.highlightUser(a.config.authDetails)});d.default.isLoggedIn()&&(b.on("userLoggedIn",a.highlightUser.bind(a,a.config.authDetails)),b.on("userLoggedOut",a.highlightUser.bind(a,a.config.authDetails)))});a.authenticateUser(c)})}},{key:"commentCountUpdated",value:function(a){localStorage.setItem("tmg.commenting.count-".concat(this.config.convConfig.articleId),a);this.commentCount.renderCommentCount(a)}},{key:"authenticateUser",value:function(a){var b=this.config.user.getLiveFyreToken();
b?a.authenticate({livefyre:b}):a.logout(function(){})}},{key:"openComments",value:function(){this.config.commentContainer.classList.add("comment--is-open");this.config.loadedStatus=!0}},{key:"haveUserStyles",value:function(a){return a.querySelector(".livefyre-user-styles")}},{key:"highlightUser",value:function(a){var b=document.getElementById(this.config.convConfig.el);if(a&&!this.haveUserStyles(b)){a=h.default.tryParse(a);var c=document.createElement("style");c.classList.add("livefyre-user-styles");
c.innerHTML='\n\t\t\t\t[data-author-id\x3d"'.concat(a.value.profile.id,'"] .fyre-comment-wrapper {\n\t\t\t\t\tbackground-color: #f8f8f8;\n\t\t\t\t\tpadding: 0 16px;\n\t\t\t\t}\n\t\t\t\t#comment__livefyre [data-author-id\x3d"').concat(a.value.profile.id,'"] .fyre-comment-like {\n\t\t\t\t\tright: 16px;\n\t\t\t\t}\n\t\t\t');b.insertBefore(c,b.firstChild)}}}],t(a.prototype,l),a}();l.a.subscribe({topic:"tmg.page.ready",func:function(){new q},runIfAlreadyPublished:!0});m.default={commenting:q}}],[[31,1,
0]]]);